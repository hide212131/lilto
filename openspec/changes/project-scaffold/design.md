## Context

Lilt-AI はデスクトップ常駐型の軽量 AI アシスタントで、macOS と Windows の両方で動作する。現時点でプロジェクトの骨格自体が存在しないため、Tauri を採用したモノレポ構成を一から構築する。フロントエンドは軽量に保ちつつ、将来的にウェイクワード検出・音声入力・AIエージェント・スキルランナー・ハートビートなどのモジュールを追加できる拡張性が求められる。

## Goals / Non-Goals

**Goals:**
- Tauri v2 を使ったクロスプラットフォームプロジェクト構成の確立
- システムトレイ常駐・ウィンドウ管理・ライフサイクルの基本動作の実装
- 機能モジュールを追加しやすい Rust バックエンドのモジュール構成の設計
- 再現可能なビルドと開発環境のセットアップ文書化

**Non-Goals:**
- ウェイクワード検出・音声入力・AIエージェント・スキルランナー・ハートビートの実装（別チェンジで行う）
- CI/CD パイプラインの構築
- 配布・自動アップデート機能

## Decisions

### 1. UI フレームワーク: Tauri v2

**選択**: Tauri v2（Rust バックエンド + WebView フロントエンド）

**理由**: README に明記されている。Electron と比較してバイナリサイズが小さく、メモリ使用量が少ない。Rust による高速なシステムレベルアクセス（将来のウェイクワード検出・オーディオ処理に有利）。

**却下した代替案**:
- Electron: メモリ・バイナリサイズが大きすぎる
- Flutter Desktop: Dart エコシステムが Rust との親和性に欠ける

---

### 2. フロントエンド技術: Vanilla HTML/CSS/JS（TypeScript）

**選択**: TypeScript + Vite（React/Vue などのフレームワークなし）

**理由**: 初期スキャフォールドの UI は最小限（トレイメニューとシンプルなウィンドウのみ）。重いフレームワークは不要。後から React などに差し替えることは可能。

**却下した代替案**:
- React: 初期フェーズでは過剰
- Svelte: Tauri の公式テンプレートに含まれるが、シンプルな初期実装には不要

---

### 3. Rust バックエンドのモジュール構成

**選択**: `src-tauri/src/` 以下に機能別モジュールを配置する構成

```
src-tauri/src/
  main.rs         # エントリーポイント
  tray.rs         # システムトレイ管理
  window.rs       # ウィンドウ管理
  lifecycle.rs    # アプリライフサイクル
```

**理由**: 将来の機能（ウェイクワード・エージェント等）を独立したモジュールとして追加しやすい。`main.rs` を汚染せずに機能を追加できる。

---

### 4. システムトレイの実装方針

**選択**: Tauri v2 の `tray` プラグイン（`tauri-plugin-shell` と組み合わせ）

**理由**: Tauri 公式のトレイ API が v2 で成熟しており、macOS/Windows 両対応が保証されている。

**ウィンドウ閉じる挙動**: `CloseRequested` イベントを Rust 側でインターセプトし、`hide()` に差し替える（終了ではなくトレイへ格納）。

---

### 5. ビルド・開発環境

**選択**: `pnpm` をパッケージマネージャーとして採用、`Cargo.lock` と `pnpm-lock.yaml` の両方をバージョン管理に含める

**理由**: 再現可能なビルドを保証するため。`pnpm` は npm より高速でディスク効率が良い。

## Risks / Trade-offs

- **Tauri v2 の API 安定性** → Tauri 公式の changelog を追い、マイナーバージョンを固定してリスクを軽減する
- **macOS でのトレイアイコン表示** → macOS はメニューバーアプリとして動作させるため `LSUIElement = true` を `Info.plist` に設定する必要がある。設定漏れでDockにアイコンが出てしまうリスクがある → 初期設定時に確認項目として明記する
- **Windows での動作検証** → 開発環境が macOS 主体のため、Windows 固有のバグが見落とされるリスクがある → CI で Windows ビルドを確認する（CI 構築は別チェンジ）

## Open Questions

- フロントエンドのビルドツールは Vite 固定で良いか、それとも Tauri CLI のデフォルト構成に任せるか？
- アプリアイコン（トレイ用）は暫定アイコンを用意するか、プレースホルダーで進めるか？
