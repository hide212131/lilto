## Context

現状の Electron 開発フローでは、GUI 変更の確認が手動確認や部分的なテストに依存しており、回帰の検出が遅れる課題がある。今回の変更では `agent-browser` を利用して Electron の主要 UI フローを E2E で実行できる状態を作り、あわせて運用ルール（完了条件）として GUI 変更時の E2E 実施を必須化する。対象は開発・検証プロセスであり、プロダクト機能自体の仕様変更は含まない。

## Goals / Non-Goals

**Goals:**
- Electron アプリの GUI 動作確認を `agent-browser` ベースの E2E シナリオとして実行可能にする。
- GUI 変更を含むタスクでは、E2E 実施結果の確認を完了条件に組み込む。
- OpenSpec の tasks から実装項目と検証項目が追跡できる状態にする。

**Non-Goals:**
- すべての GUI 画面を網羅する大規模 E2E スイートを初回で構築すること。
- 既存ユニットテストや手動確認フローを完全に置き換えること。
- CI 基盤全体の再設計。

## Decisions

1. `agent-browser` を Electron GUI の E2E ドライバとして採用する。
- 理由: Electron UI の実操作に近い確認を自動化でき、今回の「動作確認」目的に直接一致する。
- 代替案: Playwright 単独利用。却下理由は、今回の要求が `agent-browser` 利用を明示しているため。

2. 初期 E2E の対象を「起動・主要操作・正常終了」の最小フローに限定する。
- 理由: まず回帰検知の土台を作り、運用に乗せてからシナリオを拡張する方が実行可能性が高い。
- 代替案: 初期段階で網羅的シナリオを作る。却下理由は実装コストと保守コストが高く、導入遅延のリスクが大きい。

3. 完了条件はドキュメント規約（`AGENTS.md`）を更新して強制する。
- 理由: 開発者行動に直接効く場所でルール化することで、レビュー時の判定基準を明確化できる。
- 代替案: PR テンプレートのみで運用。却下理由はローカル実装時点での強制力が弱い。

## Risks / Trade-offs

- [Risk] `agent-browser` のセットアップ差異によりローカルで E2E 実行が不安定になる → Mitigation: 導入手順と前提条件（依存、起動手順）をタスク化し、初回は最小シナリオで安定性を確認する。
- [Risk] GUI 変更の判定が曖昧で E2E 必須条件が運用で揺れる → Mitigation: tasks と AGENTS.md に「GUI 変更の具体例」を記載して判断基準を明文化する。
- [Risk] E2E 実行時間増加による開発速度低下 → Mitigation: スモークシナリオ中心で開始し、重いシナリオは段階導入する。

## Migration Plan

1. `agent-browser` を用いた Electron E2E 実行手順を追加する。
2. 最小限のスモーク E2E シナリオ（起動/主要操作/終了）を実装し、ローカルで実行確認する。
3. `AGENTS.md` の完了前検証ルールに「GUI 変更時は E2E 必須」を追記する。
4. タスク実行時に E2E 結果を確認し、未実施なら完了扱いにしない運用へ移行する。
5. 問題発生時は、E2E 必須化ルールの適用範囲を一時的に限定してロールバック可能にする（ただしルール削除ではなく例外運用で対応）。

## Open Questions

- `agent-browser` の実行をローカル専用にするか、CI でも常時実行するか。
- GUI 変更判定の最終責任者を「実装者」「レビュアー」のどちらに置くか。
- 初期スモークシナリオに含める「主要操作」の具体的な画面/アクション範囲。
