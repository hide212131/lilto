## Context

既存実装は `agent-browser` のみを組み込みコピーし、`<app data>/skills` を単一の探索対象として扱っている。今回の変更では、スキル作成依頼を受けたときに `skill-creator` を優先利用しつつ、生成スキルを次回セッションでも使える永続領域に保存する必要がある。

制約として、`~/.pi/workspaces` は TTL クリーンアップ対象であり、再利用資産の保存先には使えない。加えて既存の Pi 設定更新（`~/.pi/settings.json` / `~/.pi/agent/settings.json`）との互換性を維持する必要がある。

## Goals / Non-Goals

**Goals:**
- `skill-creator` を組み込みスキルとして同梱し、起動時のスキル一覧で利用可能にする。
- スキル化依頼文（例: 「スキルにして」「再利用できるようにして」）を検知して `skill-creator` を優先選択する。
- ユーザー生成スキルを `~/.pi/skills` に保存し、探索対象として常時有効にする。
- 組み込みスキル領域とユーザー生成スキル領域を分離し、同名衝突時の優先順を定義する。

**Non-Goals:**
- `skill-creator` が生成する SKILL.md の本文品質を自動評価する仕組みの導入。
- リモートレジストリ連携や、複数端末間のスキル同期機能。
- 既存 `agent-browser` の実行仕様変更。

## Decisions

1. 保存先を用途別に分離する。
- 組み込み: `<app data>/skills/bundled/<skill-name>`
- ユーザー生成: `~/.pi/skills/<skill-name>`
- 理由: 組み込み資産はアプリ更新に追従させ、ユーザー生成資産はアプリ再起動・更新後も保持するため。
- 代替案: すべて `<app data>/skills` に混在。却下理由は、生成物と同梱物の管理境界が曖昧になり、保守/上書き挙動が不明確になるため。

2. 探索対象は `[~/.pi/skills, <app data>/skills/bundled]` とし、同名衝突時はユーザー生成を優先する。
- 理由: ユーザーがローカルで改善したスキルを優先して使えるため。
- 代替案: 組み込み優先。却下理由は、ユーザー修正が反映されず再利用性が落ちるため。

3. `skill-creator` の優先選択は既存の `agent-browser` 優先判定と同系統の軽量ルールで実装する。
- 理由: 既存アーキテクチャへの影響を最小化し、テスト範囲を限定できる。
- 代替案: LLM 判定による動的ルーティング。却下理由は、非決定性とテスト難易度が上がるため。

4. Pi 設定ファイルには両ディレクトリを `skills` 配列として登録する。
- 理由: 既存 Pi SDK 互換性を維持しつつ、永続スキルを再起動後も確実に発見できるため。
- 代替案: アプリ内探索のみで Pi 設定を更新しない。却下理由は、既存の実行経路と設定責務が分断されるため。

## Risks / Trade-offs

- [Risk] 同名スキルの優先順が利用者に見えづらい → Mitigation: ドキュメントに優先規則を明記し、ログに選択元ディレクトリを出力する。
- [Risk] `skill-creator` の依存更新で組み込みコピー処理が壊れる → Mitigation: 起動時に同梱元存在チェックを行い、欠落時は明示エラーを出す。
- [Risk] 優先判定キーワードの漏れで意図した自動選択が起きない → Mitigation: 日本語/英語の代表フレーズをテストに固定し、追加可能な判定関数として実装する。

## Migration Plan

1. 起動時のスキル配置処理を `bundled` と `user` の2系統に分離する。
2. 既存 `<app data>/skills` 配下にある `agent-browser` を `<app data>/skills/bundled/agent-browser` へ再配置する。
3. Pi 設定の `skills` 配列へ `~/.pi/skills` と `<app data>/skills/bundled` を追加登録する。
4. スキル化依頼の優先判定を追加し、既存 `agent-browser` 判定と競合しない順序で適用する。

## Open Questions

- `skill-creator` が生成するスキルのデフォルト命名規約（prefix 付与有無）を本変更で固定するか。
