# AGENTS.md

## 開発参照
この開発はAIコーディングエージェントライブラリの`Pi`を多用する。
- 開発を進める際、必要に応じてローカルフォルダ内のリポジトリを参照する。
- Pi リポジトリの場所は `.env` の `PI_REPO_DIR` に記載されている。

## ワークフローのオーケストレーション

### 自己改善ループ

* ユーザーから**どんな**修正が入っても、決まった型で `tasks/lessons.md` を更新する
* 同じミスを防ぐためのルールを自分向けに書く
* ミスの割合が下がるまで、これらの学びを容赦なく反復する
* そのセッションで関係するプロジェクトのために、開始時に学びを見直す

### 完了前の検証

* 動くことを証明するまでは、タスクを完了にしない
* 必要なら、メイン（元の状態）と自分の変更の動きの違いを比較する
* 自分に問いかける：「スタッフエンジニアならこれを承認するか？」
* テストを走らせ、ログを確認し、正しさを示す
* GUI を変更した場合は、`agent-browser` を使った E2E を必ず実施し、結果を確認してから完了にする
* GUI 変更時の E2E は `npm run e2e:electron` を実行し、成功終了と `test/artifacts/electron-e2e.png` の生成を確認する

### 優雅さを求める（バランス）

* 些細ではない変更では、立ち止まって「もっときれいなやり方はないか？」と考える
* 修正が場当たり的に感じるなら：「今ある知識をすべて踏まえて、きれいな解決策を実装する」
* 単純で明らかな修正ではこれは飛ばす。作り込みすぎない
* 提示する前に、自分の仕事を自分で問い直す

### 自律的なバグ修正（Autonomous Bug Fizing）

* バグ報告を受けたら、とにかく直す。手取り足取りは求めない
* ログ、エラー、落ちているテストを示して、それから解決する
* ユーザー側に文脈の切り替えを一切要求しない
* やり方を教えられなくても、継続的インテグレーション（CI）の失敗テストを直しに行く

## 基本原則

* **シンプルさ最優先**：すべての変更をできるだけシンプルにする。変更が影響するコードを最小限にする
* **怠けない**：根本原因を見つける。一時しのぎはしない。シニア開発者の基準でやる
* **影響は最小（Minimat Impact）**：変更は必要な部分だけに触れる。バグを持ち込まないようにする
